/*
 * jQuery MultiSelect UI Widget Filtering Plugin 1.4
 * Copyright (c) 2011 Eric Hynds
 *
 * http://www.erichynds.com/jquery/jquery-ui-multiselect-widget/
 *
 * Depends:
 *   - jQuery UI MultiSelect widget
 *
 * Dual licensed under the MIT and GPL licenses:
 *   http://www.opensource.org/licenses/mit-license.php
 *   http://www.gnu.org/licenses/gpl.html
 *
*/
(function(){define(["jquery","jqueryui/widget"],function(e,t){var n=/[\-\[\]{}()*+?.,\\\^$|#\s]/g;e.widget("ech.multiselectfilter",{options:{label:"",width:null,placeholder:"Search",autoReset:false},_create:function(){var t=this.options;var n=e(this.element);var r=this.instance=n.data("echMultiselect")||n.data("multiselect")||n.data("ech-multiselect");var i=this.header=r.menu.find(".ui-multiselect-header").addClass("ui-multiselect-hasfilter");var s=this.selectOptions=r.menu.find(".mulipleSelect-options");var o=this.wrapper=e('<div class="ui-multiselect-filter">'+(t.label.length?t.label:"")+'<input placeholder="'+t.placeholder+'" type="search"'+(/\d/.test(t.width)?'style="width:'+t.width+'px"':"")+" /></div>").appendTo(this.selectOptions);this.inputs=r.menu.find('input[type="checkbox"], input[type="radio"]');this.input=o.find("input").bind({keydown:function(e){if(e.which===13){e.preventDefault()}},keyup:e.proxy(this._handler,this),click:e.proxy(this._handler,this),search:e.proxy(this._handler,this)});this.updateCache();r._toggleChecked=function(t,n){var i=n&&n.length?n:this.labels.find("input");var s=this;var o=r._isOpen?":disabled, :hidden":":disabled";i=i.not(o).each(this._toggleState("checked",t));this.update();var u=i.map(function(){return this.value}).get();this.element.find("option").filter(function(){if(!this.disabled&&e.inArray(this.value,u)>-1){s._toggleState("selected",t).call(this)}});if(i.length){this.element.trigger("change")}};var u=e(document).bind("multiselectrefresh",e.proxy(function(){this.updateCache();this._handler()},this));if(this.options.autoReset){u.bind("multiselectclose",e.proxy(this._reset,this))}},_handler:function(t){var n=e.trim(this.input[0].value.toLowerCase()),r=this.rows;if(!n){r.show()}else{r.hide();this._showMatchingRows(t,r,n)}this._showOptionGroupsWithVisibleChildren()},_showMatchingRows:function(t,r,i){var s=this.inputs,o=this.cache;var u=new RegExp(i.replace(n,"\\$&"),"gi");this._trigger("filter",t,e.map(o,function(e,t){if(e.search(u)!==-1){r.eq(t).show();return s.get(t)}return null}))},_showOptionGroupsWithVisibleChildren:function(){this.instance.menu.find(".ui-multiselect-optgroup-label.ui-multiselect-subHeader").each(function(){var t=e(this);var n=t.nextUntil(".ui-multiselect-optgroup-label").filter(function(){return e.css(this,"display")!=="none"}).length;t.toggle(n>0)});this.instance.menu.find(".ui-multiselect-optgroup-label:not(.ui-multiselect-subHeader)").each(function(){var t=e(this);var n=t.nextUntil(".ui-multiselect-optgroup-label:not(.ui-multiselect-subHeader)").filter(function(){return e.css(this,"display")!=="none"}).length;t.toggle(n>0)})},_reset:function(){this.input.val("").trigger("keyup")},updateCache:function(){this.rows=this.instance.menu.find(".ui-multiselect-checkboxes li:not(.ui-multiselect-optgroup-label)");this.cache=this.rows.map(function(){return e(this).text().toLowerCase()}).get()},widget:function(){return this.wrapper},destroy:function(){e.Widget.prototype.destroy.call(this);this.input.val("").trigger("keyup");this.wrapper.remove()}})})})();
